\startenvironment styles-aether9

\sethyphenatedurlnormal{:=?&/}
\sethyphenatedurlbefore{?&}
\sethyphenatedurlafter {:=}

% LANGUAGE {{{
%     \setuplanguage[en][
%         leftquote=\upperleftdoublesixquote,
%         rightquote=\upperrightdoublesixquote,
%     ]
    \mainlanguage[en]
% }}}



% LAYOUT {{{
    % General layout
    \definepapersize[sheet][width=77.5mm,height=240mm]  
    \setuppapersize[sheet]
    \setuplayout[
	height=\paperheight,
	textwidth=55.5mm,
	rightedge=0mm,
	rightmargin=15mm,
	leftmargin=0mm,
	leftedge=0mm,
	top=0mm,
	header=12mm,
	footer=6mm,
	bottom=0mm,
	backspace=6mm,
	topspace=0mm,
	rightedgedistance=0mm,
	rightmargindistance=2mm,
	leftmargindistance=0mm,
	leftedgedistance=0mm,
	topdistance=0mm,
	footerdistance=0mm,
	bottomdistance=0mm
        ]
    \definelayout[nomargins][
	width=\paperwidth,
	textheight=\paperheight,
	rightedge=0mm,
	rightmargin=0mm,
	leftmargin=0mm,
	leftedge=0mm,
	top=0mm,
	header=0mm,
	footer=0mm,
	bottom=0mm,
	backspace=0mm,
	topspace=0mm,
	rightedgedistance=0mm,
	rightmargindistance=0mm,
	leftmargindistance=0mm,
	leftedgedistance=0mm,
	topdistance=0mm,
	footerdistance=0mm,
	bottomdistance=0mm
	]
%     \definecolumnset[duo][n=2, balance=no, distance=12mm, width=\getvariable{pageprops}{columnwidth}]
%     \definecolumnsetspan[wide][n=2]
%     \definepagebreak[emptyodd][yes,header,footer, odd]
%     \definepagebreak[emptyeven][yes,header,footer, even]
%     \setuphead[chapter][page=emptyodd]

\definemargindata [margintext]
    [
	location=outer,
	align=inner,
	stack=yes, % or yes
	width=15mm,
	distance=2mm
    ]

\definemargindata [refroad]
	[
		location=outer,
		align=inner,
		stack=yes, % or yes
		width=17mm,
		distance=2mm
	]
    
% }}}

% LOAD FONTS {{{
\usemodule[simplefonts]

\definesimplefont[crimbase][crimsontextroman][size=9pt] 
\definesimplefont[crimmedium][crimsontextroman][size=12pt] 
\definesimplefont[crimit][crimsontextitalic][size=12pt] 
\definesimplefont[crimbig][crimsontextroman][size=21pt] 
\definesimplefont[kasmall][karlaregular][size=8pt] 
\definesimplefont[kabase][karlaregular][size=12pt] 
\definesimplefont[kaquin][karlaregular][size=15pt] 
\definesimplefont[kafat][karlaregular][size=27pt] 
\definesimplefont[kasml][karlaregular][size=5pt] 
\definesimplefont[consolbase][consolamono][size=12pt] 
\definesimplefont[consolmini][consolamono][size=8pt] 
\definesimplefont[kaslow][karlaregularslow][size=12pt] 
\definesimplefont[crimslow][crimsontextslow][size=9pt] 
\definesimplefont[crimbigslow][crimsontextslow][size=21pt] 
\definesimplefont[consolminislow][consolamonoslow][size=8pt] 
\definesimplefont[consolbaseslow][consolamonoslow][size=12pt] 

\definesimplefont[kascience][karlaregularscience][size=12pt] 
\definesimplefont[crimscience][crimsontextscience][size=9pt] 
\definesimplefont[crimbigscience][crimsontextscience][size=21pt] 
\definesimplefont[consolminiscience][consolamonoscience][size=8pt] 
\definesimplefont[consolbasescience][consolamonoscience][size=12pt] 

\definesimplefont[kathemes][karlaregularthemes][size=12pt] 
\definesimplefont[crimthemes][crimsontextthemes][size=9pt] 
\definesimplefont[crimbigthemes][crimsontextthemes][size=21pt] 
\definesimplefont[consolminithemes][consolamonothemes][size=8pt] 
\definesimplefont[consolbasethemes][consolamonothemes][size=12pt] 


% COLORS {{{
    \setupcolors[rgb=no,cmyk=yes,state=start,overprint=yes]
% }}}


% JUSTIFICATION {{{
    \setuptolerance[verytolerant] % justification settings
%     \interlinepenalty=8000 % tries to avoid widows
%     \widowpenalty=8000 % tries to avoid widows
%     \clubpenalty=8000 % tries to avoid widows
    \doublehyphendemerits=1000000 % tries to avoid consecutive hyphenations
    %\setupfonthandling [hz] [min=50,max=50,step=10]
%     \setupalign[hz, hanging]
% }}}

% GRAPHIC ELEMENTS {{{
    % put a frame around a word
    \definetextbackground[ref][
            framecolor=black,
            background=,
        ]
% }}}


% \def\stylerunning#1{{\crimmedium #1}}

\startlua
trackers.enable("marks.set")
trackers.enable("marks.get")
\stoplua

\definemarking[P]
\definemarking[I]

\startluacode
userdata = userdata or {}
function userdata.print(start, step, limit, cond)
	
	local nstart = tonumber(start)
	local var = nstart
	local ncond = tonumber(cond)
	local dd = 0
	while (step > 0 and var <= limit) or (step <= 0 and var >= limit) 
	do
		local v = var
		if ncond == v 
		then 
		
			local i = nil
			if nstart == 4 then
				commands.getmarking("I", interfaces.variables.page, interfaces.variables.last)
				context(" --- ")
			end
			
			local p = commands.getmarking("P", interfaces.variables.page, interfaces.variables.current)
			
			if nstart == 1 then
				context(" --- ")
				commands.getmarking("I", interfaces.variables.page, interfaces.variables.first)
			end
			
			dd = 1
			break
		end 
		var = var + step
	end


end
\stopluacode

\def\blabla#1{%
	\ctxlua{userdata.print("#1", 4, 400, tex.count.pageno);}
}

\setuppagenumber[number=1]
\setuppagenumbering[location=]



\setupheadertexts[\blabla{1}][]
		[\blabla{4}][]

\setupheader[style={\crimmedium}]



% PARAGRAPHS {{{
% \showlayout
% \showmakeup
% \showframe

\input piece
\input mailtitle
\input infos
\input mail

\input chat

\input quotes

\input tech

\input bio

\input ref

\input perfo

\stopenvironment
