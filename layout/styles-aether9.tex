\startenvironment styles-aether9

\sethyphenatedurlnormal{=?&/}
\sethyphenatedurlbefore{?&-_.}
\sethyphenatedurlafter {=/:_-.}

% LANGUAGE {{{
%     \setuplanguage[en][
%         leftquote=\upperleftdoublesixquote,
%         rightquote=\upperrightdoublesixquote,
%     ]
    \mainlanguage[en]
% }}}



% LAYOUT {{{
    % General layout
    \setuppagenumbering [alternative=doublesided]
    \definepapersize[sheet][width=77.5mm,height=240mm]  
    \setuppapersize[sheet]
    \setuplayout[
	backspace=6mm,
	bottom=5mm,
	bottomdistance=0mm,
	bottomspace=0mm,
	cutspace=0mm,
	footer=15mm,
	footerdistance=0mm,
	header=12mm,
	height=239mm,
	leftedge=0mm,
	leftedgedistance=0mm,
	leftmargin=0mm,
	leftmargindistance=0mm,
	leftspace=0,
	rightedge=0mm,
	rightedgedistance=0mm,
	rightmargin=5mm,
	rightmargindistance=1.5mm,
	rightspace=0,
	textheight=222mm,
	top=0mm,
	topdistance=0mm,
	topspace=0mm,
	width=65mm
        ]
    \definelayout[nomargins][
	width=77.5mm,
	textheight=240mm,
	rightedge=0mm,
	rightmargin=0mm,
	leftmargin=0mm,
	leftedge=0mm,
	top=0mm,
	header=0mm,
	footer=0mm,
	bottom=0mm,
	backspace=0mm,
	topspace=0mm,
	rightedgedistance=0mm,
	rightmargindistance=0mm,
	leftmargindistance=0mm,
	leftedgedistance=0mm,
	topdistance=0mm,
	footerdistance=0mm,
	bottomdistance=0mm
	]
%     \definecolumnset[duo][n=2, balance=no, distance=12mm, width=\getvariable{pageprops}{columnwidth}]
%     \definecolumnsetspan[wide][n=2]
%     \definepagebreak[emptyodd][yes,header,footer, odd]
%     \definepagebreak[emptyeven][yes,header,footer, even]
%     \setuphead[chapter][page=emptyodd]

\definemargindata [margintext]
    [
	location=outer,
	align=inner,
	stack=yes, % or yes
	width=5mm,
	distance=0mm
    ]
    
% }}}

% LOAD FONTS {{{
\usemodule[simplefonts]

\definesimplefont[crimbase][crimsontextroman][size=9pt] 
\definesimplefont[crimmedium][crimsontextroman][size=15pt] 
\definesimplefont[crimit][crimsontextitalic][size=12pt] 
\definesimplefont[crimbig][crimsontextroman][size=21pt] 
\definesimplefont[kasmall][karlaaether9][size=8pt] 
\definesimplefont[kabase][karlaaether9][size=12pt] 
\definesimplefont[kaquin][karlaaether9][size=15pt] 
\definesimplefont[kafat][karlaaether9][size=27pt] 
\definesimplefont[kasml][karlaaether9][size=5.5pt]
\definesimplefont[consolbase][consolamono][size=12pt] 
\definesimplefont[consolmini][consolamono][size=8pt]

% slow, patch, chat, tech, red, science, themes, network

% Slow fonts
\definesimplefont[kabaseslow][karlaregularslow][size=12pt] 
\definesimplefont[crimbaseslow][crimsontextslow][size=9pt] 
\definesimplefont[crimbigslow][crimsontextslow][size=21pt] 
\definesimplefont[consolminislow][consolamonoslow][size=8pt] 
\definesimplefont[consolbaseslow][consolamonoslow][size=12pt] 

% Patch
\definesimplefont[kabasepatch][karlapatch][size=12pt] 
\definesimplefont[crimbasepatch][crimsontextpatch][size=9pt] 
\definesimplefont[crimbigpatch][crimsontextpatch][size=21pt] 
\definesimplefont[consolminipatch][consolamonopatch][size=8pt] 
\definesimplefont[consolbasepatch][consolamonopatch][size=12pt] 

% Chat
\definesimplefont[kabasechat][karlachat][size=12pt] 
\definesimplefont[crimbasechat][crimsontextchat][size=9pt] 
\definesimplefont[crimbigchat][crimsontextchat][size=21pt] 
\definesimplefont[consolminichat][consolamonochat][size=8pt] 
\definesimplefont[consolbasechat][consolamonochat][size=12pt] 

% Cash
\definesimplefont[kabasecash][karlacash][size=12pt] 
\definesimplefont[crimbasecash][crimsontextcash][size=9pt] 
\definesimplefont[crimbigcash][crimsontextcash][size=21pt] 
\definesimplefont[consolminicash][consolamonocash][size=8pt] 
\definesimplefont[consolbasecash][consolamonocash][size=12pt] 

% Red
\definesimplefont[kabasered][karlared][size=12pt] 
\definesimplefont[crimbasered][crimsontextred][size=9pt] 
\definesimplefont[crimbigred][crimsontextred][size=21pt] 
\definesimplefont[consolminired][consolamonored][size=8pt] 
\definesimplefont[consolbasered][consolamonored][size=12pt] 

% Science
\definesimplefont[kabasescience][karlascience][size=12pt] 
\definesimplefont[crimbasescience][crimsontextscience][size=9pt] 
\definesimplefont[crimbigscience][crimsontextscience][size=21pt] 
\definesimplefont[consolminiscience][consolamonoscience][size=8pt] 
\definesimplefont[consolbasescience][consolamonoscience][size=12pt] 

% Themes
\definesimplefont[kabasethemes][karlathemes][size=12pt] 
\definesimplefont[crimbasethemes][crimsontextthemes][size=9pt] 
\definesimplefont[crimbigthemes][crimsontextthemes][size=21pt] 
\definesimplefont[consolminithemes][consolamonothemes][size=8pt] 
\definesimplefont[consolbasethemes][consolamonothemes][size=12pt] 

% Network == Tech
\definesimplefont[kabasenetwork][karlanetwork][size=12pt] 
\definesimplefont[crimbasenetwork][crimsontextnetwork][size=9pt] 
\definesimplefont[crimbignetwork][crimsontextnetwork][size=21pt] 
\definesimplefont[consolmininetwork][consolamononetwork][size=8pt] 
\definesimplefont[consolbasenetwork][consolamononetwork][size=12pt] 

\definesimplefont[kabasetech][karlanetwork][size=12pt] 
\definesimplefont[crimbasetech][crimsontextnetwork][size=9pt] 
\definesimplefont[crimbigtech][crimsontextnetwork][size=21pt] 
\definesimplefont[consolminitech][consolamononetwork][size=8pt] 
\definesimplefont[consolbasetech][consolamononetwork][size=12pt] 

% BLANK
\defineblank[image][3mm]
\defineblank[micro][2mm]
\defineblank[small][3mm]
\defineblank[medium][7mm]
\defineblank[big][9mm]


% COLORS {{{
    \setupcolors[rgb=no,cmyk=yes,state=start,overprint=yes]
% }}}


% JUSTIFICATION {{{
    \setuptolerance[verytolerant] % justification settings
%     \interlinepenalty=8000 % tries to avoid widows
%     \widowpenalty=8000 % tries to avoid widows
%     \clubpenalty=8000 % tries to avoid widows
    \doublehyphendemerits=1000000 % tries to avoid consecutive hyphenations
    %\setupfonthandling [hz] [min=50,max=50,step=10]
%     \setupalign[hz, hanging]
% }}}

% GRAPHIC ELEMENTS {{{
    % put a frame around a word
    \definetextbackground[ref][
            framecolor=black,
            background=,
        ]
% }}}


% \def\stylerunning#1{{\crimmedium #1}}


\definemarking[P]
\definemarking[I]

\startluacode
userdata = userdata or {}
function userdata.print(start, step, limit, cond)
	
	local nstart = tonumber(start)
	local var = nstart
	local ncond = tonumber(cond)
	local dd = 0
	while (step > 0 and var <= limit) or (step <= 0 and var >= limit) 
	do
		local v = var
		if ncond == v 
		then 
		
			local i = nil
			if nstart == 2 then
				commands.getmarking("I", interfaces.variables.page, interfaces.variables.last)
				context(" --- ")
			end
			
			local p = commands.getmarking("P", interfaces.variables.page, interfaces.variables.current)
			
			if nstart == 3 then
				context(" --- ")
				commands.getmarking("I", interfaces.variables.page, interfaces.variables.first)
			end
			
			dd = 1
			break
		end 
		var = var + step
	end


end
\stopluacode

\def\blabla#1{%
	\ctxlua{userdata.print("#1", 4, 400, tex.count.pageno);}
}

\setuppagenumber[number=1]
\setuppagenumbering[location=]



\setupfootertexts[\blabla{3}][][][\blabla{2}]

\setupfooter[style={\crimmedium}]



% PARAGRAPHS {{{
% \showlayout
% \showmakeup
% \showframe

\input bio
\input chat
\input infos
\input mail
\input mailtitle
\input perfo
\input piece
\input quotes
\input ref
\input tech

\stopenvironment
